<div id="dataflow-editor" class="modal">
    <div class="flex">
        <div class="absolute inset-0 bg-gray-500 opacity-75 z-0"></div>
        <div class="absolute inset-0 place-items-center place-content-center z-10">
            <form [formGroup]="dataflowForm"
                class="card h-fit w-170 [&>div]:flex [&>div]:items-center [&>div]:py-2">
                <div class="flex justify-between">
                    <p class="text-3xl pb-3"><i class="fa fa-timeline"></i> {{!id || id === '0' ? 'Create New Dataflow' : 'Modify Dataflow'}}</p>
                    <button (click)="onClose()" class="pt-1 px-2 mr-4 self-start justify-self-end cursor-pointer rounded-sm bg-gray-100 hover:bg-gray-200"><i class="fa fa-times"></i></button>
                </div>
                <hr class="hruler">
                
                <!-- Name Field -->
                <div>
                    <label class="w-1/4 form-label required" for="name">Name</label>
                    <div class="block w-full">
                        <input class="w-3/4 input-text" type="text" id="name" formControlName="name" placeholder="Enter dataflow name">
                        <form-error [control]="dataflowForm.controls.name" [name]="'Name'" />
                    </div>
                </div>
                
                <!-- Description Field -->
                <div>
                    <label class="w-1/4 form-label" for="description">Description</label>
                    <div class="block w-full">
                        <textarea class="w-3/4 input-text" id="description" formControlName="description" placeholder="Enter dataflow description" rows="3"></textarea>
                        <form-error [control]="dataflowForm.controls.description" [name]="'Description'" />
                    </div>
                </div>
                
                <!-- Enabled Field -->
                <div>
                    <label class="w-1/4 form-label" for="enabled">Enabled</label>
                    <div class="block w-full">
                        <div class="w-3/4 flex items-center">
                            <input class="mr-2" type="checkbox" id="enabled" formControlName="enabled">
                            <span class="text-sm text-gray-600">Enable this dataflow for processing</span>
                        </div>
                    </div>
                </div>
                
                <!-- Source Connector Field -->
                <div>
                    <label class="w-1/4 form-label required" for="sourceConnectorId">Source Connector</label>
                    <div class="block w-full">
                        <select class="w-3/4 input-text" id="sourceConnectorId" formControlName="sourceConnectorId">
                            <option value="">Select source connector...</option>
                            <option *ngFor="let connector of connectors" [value]="connector.id">
                                {{connector.name}} ({{connector.type}})
                            </option>
                        </select>
                        <form-error [control]="dataflowForm.controls.sourceConnectorId" [name]="'Source Connector'" />
                    </div>
                </div>
                
                <!-- Destination Connector Field -->
                <div>
                    <label class="w-1/4 form-label required" for="destinationConnectorId">Destination Connector</label>
                    <div class="block w-full">
                        <select class="w-3/4 input-text" id="destinationConnectorId" formControlName="destinationConnectorId">
                            <option value="">Select destination connector...</option>
                            <option *ngFor="let connector of connectors" [value]="connector.id">
                                {{connector.name}} ({{connector.type}})
                            </option>
                        </select>
                        <form-error [control]="dataflowForm.controls.destinationConnectorId" [name]="'Destination Connector'" />
                    </div>
                </div>
                
                <!-- Data Flow Preview -->
                @if (dataflowForm.value.sourceConnectorId && dataflowForm.value.destinationConnectorId) {
                <div class="py-2">
                    <label class="w-1/4 form-label">Data Flow</label>
                    <div class="w-3/4 p-3 bg-gray-50 rounded border text-sm">
                        <div class="flex items-center justify-between">
                            <div class="text-center">
                                <i class="fa fa-database text-blue-500 text-lg"></i>
                                <div class="mt-1 font-medium">{{getConnectorName(dataflowForm.value.sourceConnectorId || null)}}</div>
                                <div class="text-xs text-gray-500">Source</div>
                            </div>
                            <div class="flex-1 mx-4">
                                <div class="border-t-2 border-dashed border-gray-400 relative">
                                    <i class="fa fa-arrow-right absolute -top-2 left-1/2 transform -translate-x-1/2 bg-gray-50 px-2 text-gray-600"></i>
                                </div>
                            </div>
                            <div class="text-center">
                                <i class="fa fa-database text-green-500 text-lg"></i>
                                <div class="mt-1 font-medium">{{getConnectorName(dataflowForm.value.destinationConnectorId || null)}}</div>
                                <div class="text-xs text-gray-500">Destination</div>
                            </div>
                        </div>
                    </div>
                </div>
                }
                
                <hr class="hruler">
                
                <!-- Action Buttons -->
                <div class="py-4 flex justify-between">
                    <div>
                        <button class="btn btn-blue" [disabled]="!dataflowForm.valid" (click)="onTest()">
                            <i class="fa fa-play"></i> Test Dataflow
                        </button>
                    </div>
                    <div>
                        <button class="btn btn-gray mr-4" (click)="onClose()">
                            <i class="fa fa-times"></i> Close
                        </button>
                        <button class="btn btn-blue" [disabled]="!dataflowForm.valid" (click)="onSave()">
                            <i class="fa fa-save"></i> {{!id || id === '0' ? 'Create' : 'Update'}}
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
