<div #httpConnectorEditor class="modal">
  <div class="flex">
    <div class="absolute inset-0 bg-gray-500 opacity-75 z-0"></div>
    <div class="absolute inset-0 place-items-center place-content-center z-10">
      <form [formGroup]="httpConnectorForm" class="card w-180 h-140 flex flex-col">
        <!-- Fixed Header -->
        <div class="flex justify-between items-center py-2">
          <p class="text-3xl pb-3">
            <i class="fa fa-globe"></i> {{id ? 'Modify HTTP Connector' : 'Create New HTTP Connector'}}
          </p>
          <button type="button" (click)="onClose()" class="pt-1 px-2 mr-4 self-start justify-self-end cursor-pointer rounded-sm bg-gray-100 hover:bg-gray-200">
            <i class="fa fa-times"></i>
          </button>
        </div>

        <!-- Scrollable Content Area -->
        <div class="overflow-y-auto flex-1 px-4 [&>div]:flex [&>div]:items-center [&>div]:py-2">
        <!-- Tab Navigation -->
        <div class="flex border-b border-gray-200 mb-4">
          <button 
            type="button"
            (click)="setActiveTab('basic')" 
            [class]="activeTab === 'basic' ? 'px-4 py-2 border-b-2 border-blue-500 text-blue-600 font-medium' : 'px-4 py-2 text-gray-600 hover:text-gray-800'">
            Basic Information
          </button>
          <button 
            type="button"
            (click)="setActiveTab('credentials')" 
            [class]="activeTab === 'credentials' ? 'px-4 py-2 border-b-2 border-blue-500 text-blue-600 font-medium' : 'px-4 py-2 text-gray-600 hover:text-gray-800'">
            Credentials
          </button>
          <button 
            type="button"
            (click)="setActiveTab('ssl')" 
            [class]="activeTab === 'ssl' ? 'px-4 py-2 border-b-2 border-blue-500 text-blue-600 font-medium' : 'px-4 py-2 text-gray-600 hover:text-gray-800'"
            [disabled]="authTypeControl.value === 'HTTP'">
            SSL/TLS Configuration
          </button>
        </div>

        <!-- Tab 1: Basic Information -->
        @if (activeTab === 'basic') {
        <div>
          <label class="w-1/3 form-label required" for="name">Name</label>
          <div class="block w-full">
            <input class="w-2/3 input-text" type="text" id="name" formControlName="name">
          </div>
        </div>
        <div>
          <label class="w-1/3 form-label" for="description">Description</label>
          <div class="block w-full">
            <textarea class="w-2/3 input-text" id="description" formControlName="description" rows="2"></textarea>
          </div>
        </div>
        <div>
          <label class="w-1/3 form-label required" for="hosts">Hosts</label>
          <div class="block w-full">
            <input class="w-2/3 input-text" type="text" id="hosts" formControlName="hosts" placeholder="localhost:9200,otherhost:9200">
          </div>
        </div>
        <div>
          <label class="w-1/3 form-label" for="authType">Authentication Type</label>
          <div class="block w-full">
            <select class="w-2/3 input-text" id="authType" formControlName="authType">
              @for (authType of authTypes; track authType.value) {
                <option [value]="authType.value">
                  {{ authType.label }}
                </option>
              }
            </select>
          </div>
        </div>
        }

        <!-- Tab 2: Credentials -->
        @if (activeTab === 'credentials') {
        <!-- HTTP Basic Auth (optional for HTTP) -->
        @if (authTypeControl.value === 'HTTP') {
          <div>
            <label class="w-1/3 form-label" for="username">Username (Optional)</label>
            <div class="block w-full">
              <input class="w-2/3 input-text" type="text" id="username" formControlName="username">
            </div>
          </div>
          <div>
            <label class="w-1/3 form-label" for="password">Password (Optional)</label>
            <div class="block w-full">
              <input class="w-2/3 input-text" type="password" id="password" formControlName="password">
            </div>
          </div>
        }

        <!-- HTTPS with Basic Auth -->
        @if (authTypeControl.value === 'HTTPS_BASIC') {
          <div>
            <label class="w-1/3 form-label required" for="username">Username</label>
            <div class="block w-full">
              <input class="w-2/3 input-text" type="text" id="username" formControlName="username">
            </div>
          </div>
          <div>
            <label class="w-1/3 form-label required" for="password">Password</label>
            <div class="block w-full">
              <input class="w-2/3 input-text" type="password" id="password" formControlName="password">
            </div>
          </div>
        }

        <!-- HTTPS with API Key -->
        @if (authTypeControl.value === 'HTTPS_API_KEY') {
          <div>
            <label class="w-1/3 form-label required" for="apiKey">API Key</label>
            <div class="block w-full">
              <input class="w-2/3 input-text" type="password" id="apiKey" formControlName="apiKey">
            </div>
          </div>
        }

        <!-- HTTPS with Bearer Token -->
        @if (authTypeControl.value === 'HTTPS_BEARER') {
          <div>
            <label class="w-1/3 form-label required" for="bearerToken">Bearer Token</label>
            <div class="block w-full">
              <input class="w-2/3 input-text" type="password" id="bearerToken" formControlName="bearerToken">
            </div>
          </div>
        }

        <!-- HTTPS with Client Certificate -->
        @if (authTypeControl.value === 'HTTPS_CLIENT_CERT') {
          <div>
            <label class="w-1/3 form-label required" for="clientKeystoreFile">Client Keystore File</label>
            <div class="block w-full">
              <input class="w-2/3 input-text" type="file" id="clientKeystoreFile" (change)="onFileChange($event, 'clientKeystoreFile')">
            </div>
          </div>
          <div>
            <label class="w-1/3 form-label required" for="clientKeystorePassword">Keystore Password</label>
            <div class="block w-full">
              <input class="w-2/3 input-text" type="password" id="clientKeystorePassword" formControlName="clientKeystorePassword">
            </div>
          </div>
          <div>
            <label class="w-1/3 form-label" for="clientKeyPassword">Key Password</label>
            <div class="block w-full">
              <input class="w-2/3 input-text" type="password" id="clientKeyPassword" formControlName="clientKeyPassword">
            </div>
          </div>
        }

        <!-- HTTPS with OIDC -->
        @if (authTypeControl.value === 'HTTPS_OIDC') {
          <div>
            <label class="w-1/3 form-label required" for="clientId">Client ID</label>
            <div class="block w-full">
              <input class="w-2/3 input-text" type="text" id="clientId" formControlName="clientId">
            </div>
          </div>
          <div>
            <label class="w-1/3 form-label required" for="clientSecret">Client Secret</label>
            <div class="block w-full">
              <input class="w-2/3 input-text" type="password" id="clientSecret" formControlName="clientSecret">
            </div>
          </div>
          <div>
            <label class="w-1/3 form-label required" for="issuer">Issuer</label>
            <div class="block w-full">
              <input class="w-2/3 input-text" type="text" id="issuer" formControlName="issuer" placeholder="https://accounts.google.com">
            </div>
          </div>
          <div>
            <label class="w-1/3 form-label required" for="authorizationEndpoint">Authorization Endpoint</label>
            <div class="block w-full">
              <input class="w-2/3 input-text" type="text" id="authorizationEndpoint" formControlName="authorizationEndpoint">
            </div>
          </div>
          <div>
            <label class="w-1/3 form-label required" for="tokenEndpoint">Token Endpoint</label>
            <div class="block w-full">
              <input class="w-2/3 input-text" type="text" id="tokenEndpoint" formControlName="tokenEndpoint">
            </div>
          </div>
          <div>
            <label class="w-1/3 form-label" for="userinfoEndpoint">Userinfo Endpoint</label>
            <div class="block w-full">
              <input class="w-2/3 input-text" type="text" id="userinfoEndpoint" formControlName="userinfoEndpoint">
            </div>
          </div>
          <div>
            <label class="w-1/3 form-label" for="endSessionEndpoint">End Session Endpoint</label>
            <div class="block w-full">
              <input class="w-2/3 input-text" type="text" id="endSessionEndpoint" formControlName="endSessionEndpoint">
            </div>
          </div>
          <div>
            <label class="w-1/3 form-label required" for="redirectUri">Redirect URI</label>
            <div class="block w-full">
              <input class="w-2/3 input-text" type="text" id="redirectUri" formControlName="redirectUri">
            </div>
          </div>
          <div>
            <label class="w-1/3 form-label" for="scopes">Scopes</label>
            <div class="block w-full">
              <input class="w-2/3 input-text" type="text" id="scopes" formControlName="scopes" placeholder="openid profile email">
            </div>
          </div>
          <div>
            <label class="w-1/3 form-label" for="responseType">Response Type</label>
            <div class="block w-full">
              <input class="w-2/3 input-text" type="text" id="responseType" formControlName="responseType">
            </div>
          </div>
        }

        }

        <!-- Tab 3: SSL/TLS Configuration -->
        @if (activeTab === 'ssl') {
          @if (authTypeControl.value === 'HTTP') {
            <div class="text-center py-8 text-gray-500">
              <i class="fa fa-info-circle text-4xl mb-4"></i>
              <p>SSL/TLS Configuration is not available for HTTP connections.</p>
              <p class="mt-2">Please select an HTTPS authentication type to configure SSL/TLS settings.</p>
            </div>
          } @else {
        <div>
          <label class="w-1/3 form-label" for="caCertificateFingerprint">CA Certificate Fingerprint</label>
          <div class="block w-full">
            <input class="w-2/3 input-text" type="text" id="caCertificateFingerprint" formControlName="caCertificateFingerprint" placeholder="SHA-256 fingerprint (64 characters)" maxlength="64">
          </div>
        </div>
        <div>
          <label class="w-1/3 form-label" for="caCertificateFile">CA Certificate File</label>
          <div class="block w-full">
            <input class="w-2/3 input-text" type="file" id="caCertificateFile" (change)="onFileChange($event, 'caCertificateFile')">
          </div>
        </div>
        <div>
          <label class="w-1/3 form-label" for="sslEnabledProtocols">SSL Enabled Protocols</label>
          <div class="block w-full">
            <input class="w-2/3 input-text" type="text" id="sslEnabledProtocols" formControlName="sslEnabledProtocols" placeholder="TLSv1.2,TLSv1.3">
          </div>
        </div>
          }
        }
        </div>
        <!-- End Scrollable Content Area -->

        <!-- Fixed Footer -->
        <hr class="hruler">

        <div class="py-4 px-4 flex justify-between">
          <div>
            <button type="button" class="btn btn-blue" [disabled]="!httpConnectorForm.valid" (click)="onTest()">
              <i class="fa fa-link"></i> Test Connection
            </button>
          </div>
          <div>
            <button type="button" class="btn btn-gray mr-4" (click)="onClose()">
              <i class="fa fa-times"></i> Close
            </button>
            <button type="button" class="btn btn-blue" [disabled]="!httpConnectorForm.valid" (click)="onSubmit()">
              <i class="fa fa-save"></i> {{id ? 'Update' : 'Create'}}
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
